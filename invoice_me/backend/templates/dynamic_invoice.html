<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>
      Invoice {{invoice_number}} - {{business_info['company_name']}}
    </title>

    <style>
      @page {
        size: a4 portrait;
        margin: 10mm 10mm 15mm 10mm;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        color: #2c3e50;
        line-height: 1.6;
        margin: 0;
        padding: 0;
      }

      .invoice-container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
      }

      .header {
        background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
        color: white;
        padding: 30px;
        border-radius: 8px 8px 0 0;
        margin-bottom: 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .header-left h1 {
        margin: 0;
        font-size: 32px;
        font-weight: 300;
      }

      .header-left .tagline {
        font-size: 14px;
        opacity: 0.9;
        margin-top: 5px;
      }

      .header-right {
        text-align: right;
      }

      .logo {
        max-height: 80px;
        max-width: 200px;
      }

      .invoice-details {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin-bottom: 40px;
      }

      .detail-box {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        border-left: 4px solid #27ae60;
      }

      .detail-box.credit-terms {
        border-left-color: #e74c3c;
      }

      .detail-box h3 {
        margin: 0 0 15px 0;
        color: #27ae60;
        font-size: 18px;
      }

      .detail-box.credit-terms h3 {
        color: #e74c3c;
      }

      .detail-box p {
        margin: 5px 0;
        font-size: 14px;
      }

      .addresses {
        display: flex;
        justify-content: space-between;
        margin-bottom: 40px;
        gap: 30px;
      }

      .address-block {
        flex: 1;
      }

      .address-block h3 {
        color: #27ae60;
        border-bottom: 2px solid #27ae60;
        padding-bottom: 8px;
        margin-bottom: 15px;
        font-size: 16px;
      }

      .items-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 30px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        border-radius: 8px;
        overflow: hidden;
      }

      .items-table thead {
        background: #27ae60;
        color: white;
      }

      .items-table th {
        padding: 15px;
        text-align: left;
        font-weight: 600;
        font-size: 14px;
      }

      .items-table th:last-child {
        text-align: right;
      }

      .items-table td {
        padding: 15px;
        border-bottom: 1px solid #ecf0f1;
        vertical-align: top;
      }

      .items-table td:last-child {
        text-align: right;
        font-weight: 600;
      }

      .item-title {
        font-weight: 600;
        color: #2c3e50;
      }

      .item-description {
        font-size: 12px;
        color: #7f8c8d;
        margin-top: 5px;
      }

      .item-meta {
        font-size: 11px;
        color: #95a5a6;
        margin-top: 3px;
      }

      .total-section {
        text-align: right;
        margin-bottom: 40px;
      }

      .total-row {
        display: flex;
        justify-content: flex-end;
        margin-bottom: 10px;
      }

      .total-label {
        width: 150px;
        text-align: right;
        padding-right: 20px;
        font-weight: 600;
      }

      .total-amount {
        width: 120px;
        text-align: right;
      }

      .grand-total {
        background: #27ae60;
        color: white;
        padding: 15px;
        border-radius: 8px;
        font-size: 18px;
        font-weight: bold;
      }

      .terms-section {
        background: #fff8e1;
        border: 2px solid #ff9800;
        border-radius: 12px;
        padding: 25px;
        margin-bottom: 30px;
      }

      .terms-section h3 {
        color: #f57c00;
        margin: 0 0 20px 0;
        font-size: 20px;
        text-align: center;
      }

      .terms-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
      }

      .term-item {
        background: white;
        padding: 15px;
        border-radius: 8px;
        border-left: 4px solid #ff9800;
      }

      .term-item strong {
        color: #f57c00;
        display: block;
        margin-bottom: 5px;
      }

      .custom-clause {
        background: #f0f8ff;
        border-left: 4px solid #3498db;
        padding: 15px;
        margin: 10px 0;
        border-radius: 0 8px 8px 0;
      }

      .custom-clause h4 {
        color: #3498db;
        margin: 0 0 10px 0;
      }

      .payment-section {
        background: #e8f5e8;
        border: 2px solid #27ae60;
        border-radius: 12px;
        padding: 25px;
        margin-bottom: 30px;
      }

      .payment-section h3 {
        color: #27ae60;
        margin: 0 0 20px 0;
        font-size: 20px;
        text-align: center;
      }

      .payment-methods {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
      }

      .payment-method {
        background: white;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
        border: 1px solid #bdc3c7;
      }

      .payment-method.enabled {
        border-color: #27ae60;
        box-shadow: 0 2px 8px rgba(39, 174, 96, 0.1);
      }

      .payment-method.disabled {
        opacity: 0.5;
        background: #f8f9fa;
      }

      .payment-method strong {
        display: block;
        color: #27ae60;
        margin-bottom: 5px;
        font-size: 16px;
      }

      .payment-reference {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        border-radius: 8px;
        padding: 15px;
        margin-top: 20px;
      }

      .notes-section {
        background: #f8f9fa;
        border-left: 4px solid #3498db;
        padding: 20px;
        margin-bottom: 30px;
        border-radius: 0 8px 8px 0;
      }

      .footer {
        background: #34495e;
        color: white;
        padding: 20px;
        text-align: center;
        border-radius: 0 0 8px 8px;
        margin-top: 40px;
      }

      .sa-flag {
        display: inline-block;
        width: 20px;
        height: 15px;
        background: linear-gradient(
          to bottom,
          #007749 0%,
          #007749 16.66%,
          white 16.66%,
          white 33.33%,
          #de3831 33.33%,
          #de3831 50%,
          #002395 50%,
          #002395 66.66%,
          #ffb612 66.66%,
          #ffb612 83.33%,
          black 83.33%,
          black 100%
        );
        margin-right: 8px;
        border-radius: 2px;
      }

      @media (max-width: 768px) {
        .header {
          flex-direction: column;
          text-align: center;
        }

        .invoice-details {
          grid-template-columns: 1fr;
        }

        .addresses {
          flex-direction: column;
        }

        .terms-grid {
          grid-template-columns: 1fr;
        }

        .payment-methods {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>

  <body>
    <div class="invoice-container">
      <!-- Header -->
      <div class="header">
        <div class="header-left">
          <h1><span class="sa-flag"></span>INVOICE</h1>
          <div class="tagline">
            {{business_info.get('company_name', 'Professional Business')}}
          </div>
        </div>
        <div class="header-right">
          {% if business_info.get('logo_url') %}
          <img
            src="{{business_info['logo_url']}}"
            alt="Company Logo"
            class="logo"
          />
          {% endif %}
        </div>
      </div>

      <!-- Invoice Details -->
      <div class="invoice-details">
        <div class="detail-box">
          <h3>Invoice Details</h3>
          <p><strong>Invoice #:</strong> {{invoice_number}}</p>
          <p><strong>Date Issued:</strong> {{invoice_date}}</p>
          <p><strong>Due Date:</strong> {{due_date}}</p>
          <p><strong>Payment Terms:</strong> {{payment_terms_text}}</p>
          {% if client_info.get('purchase_order_number') %}
          <p>
            <strong>PO Number:</strong> {{client_info['purchase_order_number']}}
          </p>
          {% endif %}
        </div>

        <div class="detail-box credit-terms">
          <h3>⚠️ Credit Terms</h3>
          <p><strong>Payment Due:</strong> {{payment_terms_text}}</p>
          {% if credit_terms['late_fee_enabled'] %}
          <p>
            <strong>Late Fee:</strong> {{credit_terms['late_fee_amount']}}%
            {{credit_terms['late_fee_frequency']}}
          </p>
          {% endif %} {% if credit_terms['early_discount_enabled'] %}
          <p>
            <strong>Early Discount:</strong>
            {{credit_terms['early_discount_percentage']}}% if paid within
            {{credit_terms['early_discount_days']}} days
          </p>
          {% endif %} {% if credit_terms.get('credit_limit_amount') %}
          <p>
            <strong>Credit Limit:</strong> {{currency}}
            {{"{:,.2f}".format(credit_terms['credit_limit_amount'])}}
          </p>
          {% endif %}
        </div>
      </div>

      <!-- Addresses -->
      <div class="addresses">
        <div class="address-block">
          <h3>
            From ({{business_info.get('industry', 'Business').title()}}
            Provider)
          </h3>
          <p><strong>{{business_info['company_name']}}</strong></p>
          {% if business_info.get('trading_name') and
          business_info['trading_name'] != business_info['company_name'] %}
          <p><em>Trading as: {{business_info['trading_name']}}</em></p>
          {% endif %}
          <p>{{business_info['address_line_1']}}</p>
          {% if business_info.get('address_line_2') %}
          <p>{{business_info['address_line_2']}}</p>
          {% endif %}
          <p>
            {{business_info['city']}}, {{business_info['province']}}
            {{business_info['postal_code']}}
          </p>
          <p>{{business_info.get('country', 'South Africa')}}</p>
          {% if business_info.get('vat_number') %}
          <p><strong>VAT:</strong> {{business_info['vat_number']}}</p>
          {% endif %} {% if business_info.get('company_registration') %}
          <p><strong>Reg:</strong> {{business_info['company_registration']}}</p>
          {% endif %}
          <p><strong>Email:</strong> {{business_info['email']}}</p>
          <p><strong>Tel:</strong> {{business_info['phone']}}</p>
          {% if business_info.get('website') %}
          <p><strong>Web:</strong> {{business_info['website']}}</p>
          {% endif %}
        </div>

        <div class="address-block">
          <h3>To (Client)</h3>
          <p><strong>{{client_info['company_name']}}</strong></p>
          <p><strong>Attn:</strong> {{client_info['contact_person']}}</p>
          <p><strong>Email:</strong> {{client_info['email']}}</p>
          {% if client_info.get('phone') %}
          <p><strong>Tel:</strong> {{client_info['phone']}}</p>
          {% endif %} {% if client_info.get('address_line_1') %}
          <p>{{client_info['address_line_1']}}</p>
          {% if client_info.get('address_line_2') %}
          <p>{{client_info['address_line_2']}}</p>
          {% endif %} {% if client_info.get('city') %}
          <p>
            {{client_info['city']}}, {{client_info.get('province', '')}}
            {{client_info.get('postal_code', '')}}
          </p>
          {% endif %} {% endif %} {% if client_info.get('vat_number') %}
          <p><strong>VAT:</strong> {{client_info['vat_number']}}</p>
          {% endif %}
        </div>
      </div>

      <!-- Items Table -->
      <table class="items-table">
        <thead>
          <tr>
            <th style="width: 45%">Description</th>
            <th style="width: 10%">Qty</th>
            <th style="width: 10%">Unit</th>
            <th style="width: 15%">Rate ({{currency}})</th>
            <th style="width: 20%">Amount ({{currency}})</th>
          </tr>
        </thead>
        <tbody>
          {% for item in items %}
          <tr>
            <td>
              <div class="item-title">{{item['title']}}</div>
              {% if item.get('description') %}
              <div class="item-description">{{item['description']}}</div>
              {% endif %} {% if item.get('sku') or item.get('category') %}
              <div class="item-meta">
                {% if item.get('sku') %}SKU: {{item['sku']}}{% endif %} {% if
                item.get('category') %}{% if item.get('sku') %} | {% endif
                %}Category: {{item['category']}}{% endif %}
              </div>
              {% endif %}
            </td>
            <td>{{item['quantity']}}</td>
            <td>{{item.get('unit', 'each')}}</td>
            <td>{{"{:,.2f}".format(item['unit_price'])}}</td>
            <td>{{"{:,.2f}".format(item['line_total'])}}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      <!-- Totals -->
      <div class="total-section">
        <div class="total-row">
          <div class="total-label">Subtotal:</div>
          <div class="total-amount">
            {{currency}} {{"{:,.2f}".format(subtotal)}}
          </div>
        </div>
        {% if global_discount_amount > 0 %}
        <div class="total-row">
          <div class="total-label">Discount:</div>
          <div class="total-amount">
            -{{currency}} {{"{:,.2f}".format(global_discount_amount)}}
          </div>
        </div>
        {% endif %} {% if vat_amount > 0 %}
        <div class="total-row">
          <div class="total-label">VAT ({{(vat_rate * 100)|int}}%):</div>
          <div class="total-amount">
            {{currency}} {{"{:,.2f}".format(vat_amount)}}
          </div>
        </div>
        {% endif %}
        <div class="total-row grand-total">
          <div class="total-label">Total Amount:</div>
          <div class="total-amount">
            {{currency}} {{"{:,.2f}".format(total)}}
          </div>
        </div>
      </div>

      <!-- Terms and Conditions -->
      <div class="terms-section">
        <h3>📋 Terms & Conditions</h3>

        <div class="terms-grid">
          {% if terms_conditions['include_payment_terms'] %}
          <div class="term-item">
            <strong>Payment Terms</strong>
            {{payment_terms_text}}
          </div>
          {% endif %} {% if terms_conditions['include_late_payment'] and
          credit_terms['late_fee_enabled'] %}
          <div class="term-item">
            <strong>Late Payment</strong>
            Late payments subject to {{credit_terms['late_fee_amount']}}%
            {{credit_terms['late_fee_frequency']}} service charge
          </div>
          {% endif %} {% if credit_terms['early_discount_enabled'] %}
          <div class="term-item">
            <strong>Early Payment Discount</strong>
            {{credit_terms['early_discount_percentage']}}% discount if paid
            within {{credit_terms['early_discount_days']}} days
          </div>
          {% endif %} {% if terms_conditions['include_dispute_resolution'] %}
          <div class="term-item">
            <strong>Dispute Resolution</strong>
            Disputes must be raised within
            {{credit_terms['dispute_period_days']}} days of invoice date {% if
            credit_terms.get('dispute_contact_email') %}
            <br />Contact: {{credit_terms['dispute_contact_email']}} {% endif %}
          </div>
          {% endif %} {% if credit_terms['retention_enabled'] %}
          <div class="term-item">
            <strong>Retention</strong>
            {{credit_terms['retention_percentage']}}% retention held for
            {{credit_terms['retention_period_days']}} days
          </div>
          {% endif %} {% if terms_conditions.get('delivery_terms') %}
          <div class="term-item">
            <strong>Delivery Terms</strong>
            {{terms_conditions['delivery_terms']}}
          </div>
          {% endif %} {% if terms_conditions.get('warranty_terms') %}
          <div class="term-item">
            <strong>Warranty</strong>
            {{terms_conditions['warranty_terms']}}
          </div>
          {% endif %} {% if terms_conditions.get('cancellation_policy') %}
          <div class="term-item">
            <strong>Cancellation Policy</strong>
            {{terms_conditions['cancellation_policy']}}
          </div>
          {% endif %} {% if terms_conditions['include_governing_law'] %}
          <div class="term-item">
            <strong>Governing Law</strong>
            This invoice is governed by the laws of South Africa
          </div>
          {% endif %}
        </div>

        <!-- Custom Clauses -->
        {% for clause in terms_conditions.get('custom_clauses', []) %}
        <div class="custom-clause">
          <h4>{{clause['title']}}</h4>
          <p>{{clause['content']}}</p>
        </div>
        {% endfor %}
      </div>

      <!-- Payment Section -->
      <div class="payment-section">
        <h3>💳 Payment Options</h3>

        <div class="payment-methods">
          {% if payment_config['enable_instant_eft'] %}
          <div class="payment-method enabled">
            <strong>Instant EFT</strong>
            <p>Pay instantly from your bank</p>
            <p style="color: #27ae60; font-weight: bold">Click to Pay →</p>
          </div>
          {% endif %} {% if payment_config['enable_payshap'] %}
          <div class="payment-method enabled">
            <strong>PayShap</strong>
            <p>Quick mobile payment</p>
            <p style="color: #27ae60; font-weight: bold">Scan QR Code</p>
          </div>
          {% endif %} {% if payment_config['enable_card_payments'] %}
          <div class="payment-method enabled">
            <strong>Card Payment</strong>
            <p>Credit/Debit cards</p>
            <p style="color: #27ae60; font-weight: bold">Pay Online</p>
          </div>
          {% endif %} {% if payment_config['enable_bank_transfer'] %}
          <div class="payment-method enabled">
            <strong>Bank Transfer</strong>
            <p>Traditional EFT</p>
            <p style="color: #27ae60; font-weight: bold">See details below</p>
          </div>
          {% endif %}
        </div>

        <div class="payment-reference">
          <p>
            <strong>⚠️ IMPORTANT:</strong> Use reference
            <strong>"{{payment_reference}}"</strong> for all payments
          </p>
          <p><strong>Banking Details:</strong></p>
          <p>
            {{payment_config['bank_name']}} • Account:
            {{payment_config['account_number']}} • Branch:
            {{payment_config['branch_code']}}
          </p>
          <p>
            <strong>Account Holder:</strong>
            {{payment_config['account_holder']}}
          </p>
          {% if payment_config.get('swift_code') %}
          <p>
            <strong>SWIFT:</strong> {{payment_config['swift_code']}} (for
            international payments)
          </p>
          {% endif %}
        </div>
      </div>

      <!-- Notes Section -->
      {% if notes %}
      <div class="notes-section">
        <h4>📝 Additional Notes</h4>
        <p>{{notes}}</p>
      </div>
      {% endif %}

      <!-- Footer -->
      <div class="footer">
        <p>
          <strong>{{business_info['company_name']}}</strong> • Proudly South
          African
        </p>
        {% if terms_conditions.get('footer_text') %}
        <p>{{terms_conditions['footer_text']}}</p>
        {% else %}
        <p>
          This invoice was generated securely • Questions? Reply to
          {{business_info['email']}}
        </p>
        {% endif %}
        <p style="font-size: 10px; opacity: 0.8">
          Powered by SisoNova - Get paid faster, grow your business
        </p>
      </div>
    </div>
  </body>
</html>
