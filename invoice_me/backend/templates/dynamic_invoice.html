<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>
      Invoice {{invoice_number}} - {{business_info['company_name']}}
    </title>

    <style>
      @page {
        size: a4 portrait;
        margin: 15mm 15mm 15mm 15mm;
      }

      * {
        box-sizing: border-box;
      }

      body {
        font-family: "Arial", "Helvetica", sans-serif;
        color: #333;
        line-height: 1.4;
        margin: 0;
        padding: 0;
        font-size: 12px;
      }

      .invoice-container {
        max-width: 210mm;
        margin: 0 auto;
        background: white;
      }

      /* Header Section */
      .header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 2px solid #2c5aa0;
      }

      .header-left {
        flex: 1;
      }

      .header-left h1 {
        margin: 0 0 5px 0;
        font-size: 28px;
        font-weight: bold;
        color: #2c5aa0;
        letter-spacing: 1px;
      }

      .header-left .company-name {
        font-size: 14px;
        color: #666;
        font-weight: 500;
      }

      .header-right {
        text-align: right;
        flex: 1;
      }

      .logo {
        max-height: 60px;
        max-width: 150px;
      }

      /* Invoice Info Section */
      .invoice-info {
        display: flex;
        justify-content: space-between;
        margin-bottom: 25px;
        gap: 30px;
      }

      .invoice-details,
      .credit-summary {
        flex: 1;
        background: #f8f9fa;
        padding: 15px;
        border-radius: 4px;
        border-left: 3px solid #2c5aa0;
      }

      .credit-summary {
        border-left-color: #dc3545;
      }

      .invoice-details h3,
      .credit-summary h3 {
        margin: 0 0 10px 0;
        font-size: 14px;
        font-weight: bold;
        color: #2c5aa0;
      }

      .credit-summary h3 {
        color: #dc3545;
      }

      .invoice-details p,
      .credit-summary p {
        margin: 3px 0;
        font-size: 11px;
        line-height: 1.3;
      }

      .invoice-details strong,
      .credit-summary strong {
        font-weight: 600;
      }

      /* Address Section */
      .addresses {
        display: flex;
        justify-content: space-between;
        margin-bottom: 25px;
        gap: 30px;
      }

      .address-block {
        flex: 1;
        padding: 15px;
        background: #fff;
        border: 1px solid #e9ecef;
        border-radius: 4px;
      }

      .address-block h3 {
        margin: 0 0 10px 0;
        font-size: 13px;
        font-weight: bold;
        color: #2c5aa0;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        border-bottom: 1px solid #e9ecef;
        padding-bottom: 5px;
      }

      .address-block p {
        margin: 2px 0;
        font-size: 11px;
        line-height: 1.3;
      }

      .address-block .company-name {
        font-weight: bold;
        font-size: 12px;
        color: #333;
      }

      /* Items Table */
      .items-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
        font-size: 11px;
        border: 1px solid #dee2e6;
      }

      .items-table thead {
        background: #2c5aa0;
        color: white;
      }

      .items-table th {
        padding: 10px 8px;
        text-align: left;
        font-weight: 600;
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.3px;
      }

      .items-table th:last-child,
      .items-table td:last-child {
        text-align: right;
      }

      .items-table td {
        padding: 8px;
        border-bottom: 1px solid #e9ecef;
        vertical-align: top;
      }

      .items-table tbody tr:nth-child(even) {
        background: #f8f9fa;
      }

      .item-title {
        font-weight: 600;
        color: #333;
        font-size: 11px;
      }

      .item-description {
        font-size: 10px;
        color: #666;
        margin-top: 2px;
        line-height: 1.2;
      }

      .item-meta {
        font-size: 9px;
        color: #999;
        margin-top: 2px;
      }

      /* Totals Section */
      .totals-section {
        margin-bottom: 25px;
      }

      .totals-table {
        width: 100%;
        max-width: 300px;
        margin-left: auto;
        font-size: 11px;
      }

      .totals-table td {
        padding: 4px 8px;
        border: none;
      }

      .totals-table .label {
        text-align: right;
        font-weight: 600;
        color: #666;
      }

      .totals-table .amount {
        text-align: right;
        font-weight: 600;
        width: 100px;
      }

      .totals-table .total-row {
        background: #2c5aa0;
        color: white;
        font-weight: bold;
        font-size: 13px;
      }

      .totals-table .total-row td {
        padding: 8px;
      }

      /* Terms Section */
      .terms-section {
        background: #fff8e1;
        border: 1px solid #ffc107;
        border-radius: 4px;
        padding: 15px;
        margin-bottom: 20px;
      }

      .terms-section h3 {
        margin: 0 0 10px 0;
        font-size: 13px;
        color: #856404;
        font-weight: bold;
      }

      .terms-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 10px;
      }

      .term-item {
        background: white;
        padding: 8px;
        border-radius: 3px;
        border-left: 3px solid #ffc107;
        font-size: 10px;
      }

      .term-item strong {
        display: block;
        color: #856404;
        font-size: 10px;
        margin-bottom: 3px;
      }

      /* Payment Section */
      .payment-section {
        background: #e8f5e8;
        border: 1px solid #28a745;
        border-radius: 4px;
        padding: 15px;
        margin-bottom: 20px;
      }

      .payment-section h3 {
        margin: 0 0 10px 0;
        font-size: 13px;
        color: #155724;
        font-weight: bold;
      }

      .payment-methods {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 8px;
        margin-bottom: 10px;
      }

      .payment-method {
        background: white;
        padding: 8px;
        border-radius: 3px;
        text-align: center;
        border: 1px solid #28a745;
        font-size: 9px;
      }

      .payment-method strong {
        display: block;
        color: #155724;
        font-size: 10px;
        margin-bottom: 2px;
      }

      .payment-reference {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        border-radius: 3px;
        padding: 10px;
        margin-top: 10px;
        font-size: 10px;
      }

      .payment-reference strong {
        color: #856404;
      }

      /* Notes Section */
      .notes-section {
        background: #f8f9fa;
        border-left: 3px solid #6c757d;
        padding: 10px;
        margin-bottom: 20px;
        border-radius: 0 3px 3px 0;
      }

      .notes-section h4 {
        margin: 0 0 5px 0;
        font-size: 12px;
        color: #495057;
      }

      .notes-section p {
        margin: 0;
        font-size: 10px;
        line-height: 1.3;
      }

      /* Footer */
      .footer {
        background: #343a40;
        color: white;
        padding: 10px;
        text-align: center;
        border-radius: 3px;
        font-size: 9px;
      }

      .footer p {
        margin: 2px 0;
      }

      /* Utility Classes */
      .text-right {
        text-align: right;
      }
      .text-center {
        text-align: center;
      }
      .font-bold {
        font-weight: bold;
      }
      .text-small {
        font-size: 10px;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .header {
          flex-direction: column;
          text-align: center;
        }

        .invoice-info {
          flex-direction: column;
        }

        .addresses {
          flex-direction: column;
        }

        .terms-grid {
          grid-template-columns: 1fr;
        }

        .payment-methods {
          grid-template-columns: 1fr;
        }
      }

      @media print {
        body {
          font-size: 11px;
        }
        .payment-method {
          border: 1px solid #ccc;
        }
      }
    </style>
  </head>

  <body>
    <div class="invoice-container">
      <!-- Header -->
      <div class="header">
        <div class="header-left">
          <h1>INVOICE</h1>
          <div class="company-name">
            {{business_info.get('company_name', 'Professional Business')}}
          </div>
        </div>
        <div class="header-right">
          {% if business_info.get('logo_url') %}
          <img
            src="{{business_info['logo_url']}}"
            alt="Company Logo"
            class="logo"
          />
          {% endif %}
        </div>
      </div>

      <!-- Invoice Information -->
      <div class="invoice-info">
        <div class="invoice-details">
          <h3>Invoice Information</h3>
          <p><strong>Invoice #:</strong> {{invoice_number}}</p>
          <p><strong>Issue Date:</strong> {{invoice_date}}</p>
          <p><strong>Due Date:</strong> {{due_date}}</p>
          <p><strong>Terms:</strong> {{payment_terms_text}}</p>
          {% if client_info.get('purchase_order_number') %}
          <p><strong>PO #:</strong> {{client_info['purchase_order_number']}}</p>
          {% endif %}
        </div>

        <div class="credit-summary">
          <h3>Payment Terms</h3>
          <p><strong>Payment Due:</strong> {{payment_terms_text}}</p>
          {% if credit_terms['late_fee_enabled'] %}
          <p>
            <strong>Late Fee:</strong> {{credit_terms['late_fee_amount']}}%
            {{credit_terms['late_fee_frequency']}}
          </p>
          {% endif %} {% if credit_terms['early_discount_enabled'] %}
          <p>
            <strong>Early Discount:</strong>
            {{credit_terms['early_discount_percentage']}}%
            ({{credit_terms['early_discount_days']}} days)
          </p>
          {% endif %} {% if credit_terms.get('credit_limit_amount') %}
          <p>
            <strong>Credit Limit:</strong> {{currency}}
            {{"{:,.2f}".format(credit_terms['credit_limit_amount'])}}
          </p>
          {% endif %}
        </div>
      </div>

      <!-- Addresses -->
      <div class="addresses">
        <div class="address-block">
          <h3>Bill From</h3>
          <p class="company-name">{{business_info['company_name']}}</p>
          {% if business_info.get('trading_name') and
          business_info['trading_name'] != business_info['company_name'] %}
          <p><em>t/a {{business_info['trading_name']}}</em></p>
          {% endif %}
          <p>{{business_info['address_line_1']}}</p>
          {% if business_info.get('address_line_2') %}
          <p>{{business_info['address_line_2']}}</p>
          {% endif %}
          <p>
            {{business_info['city']}}, {{business_info['province']}}
            {{business_info['postal_code']}}
          </p>
          {% if business_info.get('vat_number') %}
          <p><strong>VAT:</strong> {{business_info['vat_number']}}</p>
          {% endif %}
          <p><strong>Email:</strong> {{business_info['email']}}</p>
          <p><strong>Phone:</strong> {{business_info['phone']}}</p>
        </div>

        <div class="address-block">
          <h3>Bill To</h3>
          <p class="company-name">{{client_info['company_name']}}</p>
          <p><strong>Attn:</strong> {{client_info['contact_person']}}</p>
          <p><strong>Email:</strong> {{client_info['email']}}</p>
          {% if client_info.get('phone') %}
          <p><strong>Phone:</strong> {{client_info['phone']}}</p>
          {% endif %} {% if client_info.get('address_line_1') %}
          <p>{{client_info['address_line_1']}}</p>
          {% if client_info.get('address_line_2') %}
          <p>{{client_info['address_line_2']}}</p>
          {% endif %} {% if client_info.get('city') %}
          <p>
            {{client_info['city']}}, {{client_info.get('province', '')}}
            {{client_info.get('postal_code', '')}}
          </p>
          {% endif %} {% endif %} {% if client_info.get('vat_number') %}
          <p><strong>VAT:</strong> {{client_info['vat_number']}}</p>
          {% endif %}
        </div>
      </div>

      <!-- Items Table -->
      <table class="items-table">
        <thead>
          <tr>
            <th style="width: 50%">Description</th>
            <th style="width: 8%">Qty</th>
            <th style="width: 10%">Unit</th>
            <th style="width: 16%">Rate</th>
            <th style="width: 16%">Amount</th>
          </tr>
        </thead>
        <tbody>
          {% for item in items %}
          <tr>
            <td>
              <div class="item-title">{{item['title']}}</div>
              {% if item.get('description') %}
              <div class="item-description">{{item['description']}}</div>
              {% endif %} {% if item.get('sku') or item.get('category') %}
              <div class="item-meta">
                {% if item.get('sku') %}SKU: {{item['sku']}}{% endif %} {% if
                item.get('category') %}{% if item.get('sku') %} • {% endif
                %}{{item['category']}}{% endif %}
              </div>
              {% endif %}
            </td>
            <td>{{item['quantity']}}</td>
            <td>{{item.get('unit', 'ea')}}</td>
            <td>{{currency}} {{"{:,.2f}".format(item['unit_price'])}}</td>
            <td>{{currency}} {{"{:,.2f}".format(item['line_total'])}}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      <!-- Totals -->
      <div class="totals-section">
        <table class="totals-table">
          <tr>
            <td class="label">Subtotal:</td>
            <td class="amount">{{currency}} {{"{:,.2f}".format(subtotal)}}</td>
          </tr>
          {% if global_discount_amount > 0 %}
          <tr>
            <td class="label">Discount:</td>
            <td class="amount">
              -{{currency}} {{"{:,.2f}".format(global_discount_amount)}}
            </td>
          </tr>
          {% endif %} {% if vat_amount > 0 %}
          <tr>
            <td class="label">VAT ({{(vat_rate * 100)|int}}%):</td>
            <td class="amount">
              {{currency}} {{"{:,.2f}".format(vat_amount)}}
            </td>
          </tr>
          {% endif %}
          <tr class="total-row">
            <td class="label">TOTAL:</td>
            <td class="amount">{{currency}} {{"{:,.2f}".format(total)}}</td>
          </tr>
        </table>
      </div>

      <!-- Terms and Conditions -->
      <div class="terms-section">
        <h3>Terms & Conditions</h3>
        <div class="terms-grid">
          {% if credit_terms['late_fee_enabled'] %}
          <div class="term-item">
            <strong>Late Payment</strong>
            {{credit_terms['late_fee_amount']}}%
            {{credit_terms['late_fee_frequency']}} service charge on overdue
            amounts
          </div>
          {% endif %} {% if credit_terms['early_discount_enabled'] %}
          <div class="term-item">
            <strong>Early Payment</strong>
            {{credit_terms['early_discount_percentage']}}% discount if paid
            within {{credit_terms['early_discount_days']}} days
          </div>
          {% endif %}
          <div class="term-item">
            <strong>Disputes</strong>
            Must be raised within {{credit_terms.get('dispute_period_days', 7)}}
            days of invoice date
          </div>
          {% if credit_terms['retention_enabled'] %}
          <div class="term-item">
            <strong>Retention</strong>
            {{credit_terms['retention_percentage']}}% held for
            {{credit_terms['retention_period_days']}} days
          </div>
          {% endif %}
        </div>
      </div>

      <!-- Payment Information -->
      <div class="payment-section">
        <h3>Payment Information</h3>

        <div class="payment-methods">
          {% if payment_config['enable_instant_eft'] %}
          <div class="payment-method">
            <strong>Instant EFT</strong>
            <div>Pay instantly online</div>
          </div>
          {% endif %} {% if payment_config['enable_payshap'] %}
          <div class="payment-method">
            <strong>PayShap</strong>
            <div>Mobile payment</div>
          </div>
          {% endif %} {% if payment_config['enable_bank_transfer'] %}
          <div class="payment-method">
            <strong>Bank Transfer</strong>
            <div>Traditional EFT</div>
          </div>
          {% endif %} {% if payment_config['enable_card_payments'] %}
          <div class="payment-method">
            <strong>Card Payment</strong>
            <div>Credit/Debit</div>
          </div>
          {% endif %}
        </div>

        <div class="payment-reference">
          <p><strong>Payment Reference:</strong> {{payment_reference}}</p>
          <p>
            <strong>Bank:</strong> {{payment_config['bank_name']}} |
            <strong>Account:</strong> {{payment_config['account_number']}} |
            <strong>Branch:</strong> {{payment_config['branch_code']}}
          </p>
          <p>
            <strong>Account Holder:</strong>
            {{payment_config['account_holder']}}
          </p>
          {% if payment_config.get('swift_code') %}
          <p>
            <strong>SWIFT:</strong> {{payment_config['swift_code']}}
            (international)
          </p>
          {% endif %}
        </div>
      </div>

      <!-- Notes -->
      {% if notes %}
      <div class="notes-section">
        <h4>Additional Notes</h4>
        <p>{{notes}}</p>
      </div>
      {% endif %}

      <!-- Footer -->
      <div class="footer">
        <p>
          <strong>{{business_info['company_name']}}</strong> |
          {{business_info['email']}} | {{business_info['phone']}}
        </p>
        <p>
          This invoice was generated electronically and is valid without
          signature.
        </p>
      </div>
    </div>
  </body>
</html>
